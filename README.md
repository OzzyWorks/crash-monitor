# 米国株式市場 暴落監視ツール

> 「今は投入を検討すべき局面か否か」を毎営業日Slackに通知する監視ツール

[![Market Monitor](https://github.com/<YOUR_USERNAME>/crash-monitor/actions/workflows/monitor.yml/badge.svg)](https://github.com/<YOUR_USERNAME>/crash-monitor/actions/workflows/monitor.yml)

## 📋 目次

- [概要](#概要)
- [このツールの思想](#このツールの思想)
- [監視対象と判定ルール](#監視対象と判定ルール)
- [通知仕様](#通知仕様)
- [セットアップ](#セットアップ)
- [使い方](#使い方)
- [技術仕様](#技術仕様)

---

## 概要

米国株式市場の暴落を検知し、**「投入検討」または「投入対象外」**の二択判断を提供する監視ツールです。

### 特徴

- ✅ **二択判断**: 投入するか・しないかの明確な判断のみ
- ✅ **感情排除**: 機械的な判定基準による客観的な判断
- ✅ **初回検知**: 暴落開始の瞬間を逃さない通知
- ✅ **自動実行**: GitHub Actionsによる毎営業日の自動監視
- ✅ **Slack連携**: リアルタイムなSlack通知

---

## このツールの思想

### 1. **予測しない**
将来の株価を予測しません。現在の事実のみを報告します。

### 2. **感情を入れない**
恐怖や欲望といった感情を排除し、機械的な判定基準のみで判断します。

### 3. **判断を二択に絞る**
「投入検討」か「投入対象外」の二択のみ。積立額や分割投入などの計算は一切行いません。

### 4. **暴落という瞬間を逃さない**
暴落条件を初めて満たした日を最重要視し、確実に通知します。

---

## 監視対象と判定ルール

### 監視対象指数（Yahoo Financeから取得）

| 指数 | シンボル | 役割 |
|------|---------|------|
| NASDAQ100 | ^NDX | 価格軸（第1監視軸） |
| S&P500 | ^GSPC | 価格軸（補助指標） |
| VIX指数 | ^VIX | 心理軸（第2監視軸） |

### 判定ルール

#### 🔴 暴落判定（投入検討）

以下の**いずれか**を満たす場合に「投入検討」と判定:

1. **メジャー暴落条件**
   - NASDAQ100 が 52週高値比 **-20% 以下**

2. **マイナー暴落条件**
   - NASDAQ100 が **-15% 以下** かつ VIX指数が **30以上**

#### 🟢 非暴落（投入対象外）

上記条件を満たさない場合は「投入対象外」と判定（通知なし）。

### 評価基準の詳細

- **52週高値**: 過去252営業日の最高値を使用
- **下落率**: `(現在値 - 52週高値) / 52週高値 × 100`

---

## 通知仕様

### 実行タイミング

- **毎営業日 9:30 JST** (GitHub Actions cron)
- 月曜日〜金曜日の平日のみ実行

### 通知種別

#### 1. 初回検知（最重要） 💥

暴落条件を**初めて**満たした日に送信される詳細通知。

```
【米国株式市場・暴落監視レポート】

■ 市場状態
💥 投入検討

■ 初回検知トリガー
NASDAQ100 が 52週高値比 -20% を超える下落に突入しました。

■ 市場データ
NASDAQ100: 15234.56 (-21.3%)
S&P500: 4532.12 (-15.2%)
VIX指数: 35.4

■ 補足
価格下落と市場心理の悪化が同時に発生しています。
```

#### 2. 継続中 ⚠️

すでに暴落判定中の場合の簡易通知。

```
【米国株式市場・暴落監視レポート】

■ 市場状態
⚠️ 投入検討（継続中）

NASDAQ100 -21.3% / S&P500 -15.2% / VIX 35.4
```

#### 3. 投入対象外 ✅

通常状態の場合も毎営業日通知を送信。

```
【米国株式市場・暴落監視レポート】

■ 市場状態
✅ 投入対象外（通常状態）

■ 市場データ
NASDAQ100: 18234.56 (-5.2%)
S&P500: 5432.12 (-3.1%)
VIX指数: 15.4

■ 補足
市場は正常範囲内で推移しています。
```

---

## セットアップ

### 1. リポジトリのフォーク/クローン

```bash
# フォークまたはクローン
git clone https://github.com/<YOUR_USERNAME>/crash-monitor.git
cd crash-monitor
```

### 2. Slack Webhook URLの取得

1. [Slack API](https://api.slack.com/apps) にアクセス
2. 「Create New App」→「From scratch」を選択
3. App名と通知先Workspaceを選択
4. 「Incoming Webhooks」を有効化
5. 「Add New Webhook to Workspace」で通知先チャンネルを選択
6. 生成されたWebhook URLをコピー

### 3. GitHub Secretsの設定

1. GitHubリポジトリの「Settings」→「Secrets and variables」→「Actions」を開く
2. 「New repository secret」をクリック
3. 以下のSecretを追加:

| Name | Value |
|------|-------|
| `SLACK_WEBHOOK_URL` | 取得したSlack Webhook URL |

### 4. GitHub Actionsの有効化

1. リポジトリの「Actions」タブを開く
2. ワークフロー「米国株式市場暴落監視」を確認
3. 必要に応じて「Enable workflow」をクリック

### 5. 動作確認（手動実行）

1. 「Actions」タブから「米国株式市場暴落監視」を選択
2. 「Run workflow」→「Run workflow」をクリック
3. 実行ログとSlack通知を確認

---

## 使い方

### 自動実行

セットアップ完了後、毎営業日 9:30 JSTに自動的に実行されます。

- **暴落初回検知時**: 詳細な通知がSlackに送信されます
- **暴落継続中**: 簡易通知が送信されます
- **通常状態**: 通知なし（GitHub Actionsのログのみ）

### 手動実行

GitHub Actionsから手動で実行することも可能です:

1. リポジトリの「Actions」タブを開く
2. 「米国株式市場暴落監視」ワークフローを選択
3. 「Run workflow」ボタンをクリック

### ローカルでのテスト実行

```bash
# 依存関係のインストール
pip install -r requirements.txt

# 環境変数を設定して実行
export SLACK_WEBHOOK_URL="your-webhook-url"
python monitor.py
```

---

## 技術仕様

### ファイル構成

```
crash-monitor/
├── .github/
│   └── workflows/
│       └── monitor.yml          # GitHub Actions ワークフロー
├── monitor.py                   # メイン監視スクリプト
├── state.json                   # 状態管理ファイル（自動更新）
├── requirements.txt             # Python依存関係
├── .gitignore
└── README.md
```

### 依存パッケージ

- `yfinance`: Yahoo Financeからの市場データ取得
- `requests`: Slack通知の送信

### 状態管理

`state.json` で以下の情報を管理:

```json
{
  "is_crash": false,              // 現在暴落中か
  "first_detected": null,         // 初回検知日時（ISO 8601）
  "last_checked": "2024-01-15T09:30:00"  // 最終チェック日時
}
```

このファイルはGitHub Actionsによって自動的に更新・コミットされます。

### データ取得仕様

- **データソース**: Yahoo Finance API（yfinance経由）
- **取得期間**: 過去252営業日分のデータ
- **取得頻度**: 毎営業日1回（9:30 JST）
- **タイムアウト**: 10秒

---

## トラブルシューティング

### 通知が届かない

1. `SLACK_WEBHOOK_URL` が正しく設定されているか確認
2. GitHub Actionsのログで実行状態を確認
3. Slack AppのIncoming Webhooksが有効か確認

### データ取得エラー

- Yahoo Financeの一時的な障害の可能性
- 次回の自動実行を待つか、手動で再実行

### 状態ファイルのコミット失敗

- リポジトリの書き込み権限を確認
- `GITHUB_TOKEN` のパーミッションを確認

---

## ライセンス

MIT License

---

## 免責事項

このツールは情報提供のみを目的としており、投資助言や推奨を行うものではありません。
投資判断は自己責任で行ってください。
